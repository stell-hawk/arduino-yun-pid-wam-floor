Прошивка расчитана на работу через Arduino Yun Shiled
тестировалась и использовалась на Arduino 2560

# Настройка:
1. При перезагрузке arduino основные параметры считываются с файловой системы Arduino Yun Shield обязательно наличие файлов:

-------------------
> /root/K_P ->0.5 //Коэфициент  усиления регулятора

> /root/K_I -> 100//интегральная составляющая регулятора

> /root/CYCLE -> 10 // время обновления температуры для pid  в секундах

> /root/BUS_TEMP_UPDATE_TIME -> 10000 // Частота обновления датчиков на шине милисекундах cек*1000 (одним числом)

> /root/OUT_ZERO_VALUE -> 27 //температура обратки при нулевой температуре на улице

> /root/OUT_25_VALUE -> 37 // температура обраткипри -25 на улице
-------------------

2. Базовые настройки прошивки находятся в шапке файла dragino.ino
-------------------
> #define ONE_WIRE_BUS 22                               // шина с датчиками

> #define ONE_WIRE_PID 26                               // нога с ПИД регулятором !НА ШИНЕ 1 датчик

> #define ONE_WIRE_OUT 24                               // нога с датчиком уличной температуры !НА ШИНЕ 1 датчик

> #define RELAY_PIN     23                              // выход с реле
-------------------

3. Настройка датчика подачи теплых полов:
-------------------
> #define feed_index     2                              // номер датчика на линии отвечающего за подачу
-------------------

К сожалению система изначально не затачивалась на работу с тремя датчиками (обратка, улица, подача)
поэтому в ней данные датчика подачи берутся из шины.

Чтобы определить feed_index необходимо подключить необходимые датчики на шину и определить какой из них отвечает за линию подачи теплого пола.

для этого смотрим содержимое файла /tmp/bus.txt

оно такого вида:
------------------
> aa[0]: 10dc6e70030800cb

> aa[1]: 10716670030800e3

> aa[2]: 28aaebe13f1401e9

> aa[3]: 28aa0f703f140142

> aa[4]: 28aa6fa43f14015c

> aa[5]: 28d693010000001e

> aa[6]: 28ee4e0a1b1601e7

> ta[0]: 42.69

> ta[1]: 42.81

> ta[2]: 35.13

> ta[3]: 23.75

> ta[4]: 37.50

> ta[5]: 24.00

> ta[6]: 24.56
------------------

в моём случае нужный датчик имеет индекс 2 - именно это значение нам нужно.


4. Параметры подлюченного реле
------------------
> #define HIGH_LEVEL     1                              //состояние открытого реле
------------------
Какое значение должно быть на ножке arduino чтобы реле открылось

------------------
> #define LOW_LEVEL     0                              //низкий уровень - состояние закрытого реле
------------------
Какое значение должно быть на ножке arduino чтобы реле закрылось

------------------
> #define START_LEVEL     LOW_LEVEL                   //состояние в начале работы
------------------

Какое значение должно принять реле в самом начале работы 

С данными цифрами надо быть аккуратным. потому что бывают разные сочения реле и термоголовки.

в моем случае использует low_level реле(замкнуто когда ноль на входе) и NO термоголовка(при подаче питания закрывается).

проверяем: на pin 1 -> реле разомкнуто-> термоголовка открывается

на pin 0 -> реле замкнуто> термоголовка закрывается.



5. В функции detectTemperature есть строка

client.get(.....);

это строка отвечает за прием логов системы сторонним сервером

Если Вам нет необходимости смотреть красивые графики то её нужно отключить

если же нужно файл dragino.php имеет в папке. так же как и дамп базы необходимый для работы dump.sql


# Работа системы :

1.Информацию о состоянии переменных можно посмотреть тут:

1.1. http://IP_DRAGINO_SHIELD/arduino/data/values/

выводит основные параметры на текущий момент:

-------------------
> SET_VALUE : 29.20

> K_P : 0.50

> K_I : 100.00

> CYCLE : 10.00

> SUM_D_T : 50.00

> DELTA_PV_PV2 : 5.00

> BUS_TEMP_UPDATE_TIME : 10000

> min_power : 85

> max_power : 100

> OUT_ZERO_VALUE : 27

> OUT_25_VALUE : 37

-------------------
1.2. http://IP_DRAGINO_SHIELD/arduino/data/sensors/

выводит текущие значения всех подключенных датчиков
-------------------
> pid : 29.00

> out : -5.13

> 10dc6e70030800cb : 40.25

> 10716670030800e3 : 42.25

> 28aaebe13f1401e9 : 31.31

> 28aa0f703f140142 : 22.94

> 28aa6fa43f14015c : 35.63

> 28d693010000001e : 23.12

> 28ee4e0a1b1601e7 : 24.56
-------------------


1.3. Чтение конкретной переменной:

http://IP_DRAGINO_SHIELD/arduino/K_P

http://IP_DRAGINO_SHIELD/arduino/K_I

http://IP_DRAGINO_SHIELD/arduino/CYCLE

http://IP_DRAGINO_SHIELD/arduino/BUS_TEMP_UPDATE_TIME

http://IP_DRAGINO_SHIELD/arduino/OUT_ZERO_VALUE 

http://IP_DRAGINO_SHIELD/arduino/OUT_25_VALUE 



1.4.Установка переменной к строкам описанным в п.1.3 необходимо через / дописать значение например

http://IP_DRAGINO_SHIELD/arduino/K_P/1.5

остальные параметры по аналогии



2.Содержимое файла io.h взято целиком с тюториала по Arduino Yun оно нужно для работы напрямую с пинами Arduino.
для рабоыт системы это не нужно. примеры использования  ест ьв шапке этого файла



